!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(t,e){const i=[];for(;e--;)i.push(new Array(t).fill(0));this.matrix=i}collide(t){const[e,i]=[t.matrix,t.position];for(let t=0;t<e.length;++t)for(let s=0;s<e[t].length;++s)if(0!==e[t][s]&&0!==(this.matrix[t+i.y]&&this.matrix[t+i.y][s+i.x]))return!0;return!1}merge(t){t.matrix.forEach((e,i)=>{e.forEach((e,s)=>{0!==e&&(this.matrix[i+t.position.y][s+t.position.x]=e)})})}sweep(){let t=0;t:for(let e=this.matrix.length-1;e>0;--e){for(let t=0;t<this.matrix[e].length;++t)if(0===this.matrix[e][t])continue t;const i=this.matrix.splice(e,1)[0].fill(0);t+=10,this.matrix.unshift(i),++e}return t}};var r=class{constructor(t){this.arena=t.arena,this.defaultInterval=1e3,this.dropCounter=0,this.dropInterval=this.defaultInterval,this.piece=t.piece,this.matrix=this.piece.getRandomPiece(),this.position={x:0,y:0},this.score=0,this.tetris=t}drop(){if(this.position.y++,this.arena.collide(this)){this.position.y--,this.arena.merge(this),this.reset();const t=this.arena.sweep();this.score+=t,this.dropInterval-=t,this.tetris.updateScore(this.score)}this.dropCounter=0}move(t){this.position.x+=t,this.arena.collide(this)&&(this.position.x-=t)}reset(){const t=this.piece.getRandomPiece();this.matrix=t;const e=this.arena.matrix[0].length/2|0,i=this.matrix[0].length/2|0;this.position.y=0,this.position.x=e-i,this.arena.collide(this)&&(this.arena.matrix.forEach(t=>t.fill(0)),this.score=0,this.dropInterval=this.defaultInterval,this.tetris.updateScore())}rotate(t){const e=this.position.x;let i=1;for(this.rotateMatrix(t);this.arena.collide(this);)if(this.position.x+=i,(i=-(i+(i>0?1:-1)))>this.matrix[0].length)return this.rotateMatrix(-t),void(this.position.x=e)}rotateMatrix(t){for(let t=0;t<this.matrix.length;++t)for(let e=0;e<t;++e)[this.matrix[e][t],this.matrix[t][e]]=[this.matrix[t][e],this.matrix[e][t]];return t>0?this.matrix.forEach(t=>t.reverse()):this.matrix.reverse()}update(t){this.dropCounter+=t,this.dropCounter>this.dropInterval&&this.drop()}};var a=class{constructor(){this.colors=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"],this.pieces="IJLOSTZ",this.random=[]}createPiece(t){switch(t){case"I":return[[0,6,0,0],[0,6,0,0],[0,6,0,0],[0,6,0,0]];case"J":return[[0,2,0],[0,2,0],[2,2,0]];case"L":return[[0,3,0],[0,3,0],[0,3,3]];case"O":return[[7,7],[7,7]];case"S":return[[0,5,5],[5,5,0],[0,0,0]];case"T":return[[1,1,1],[0,1,0],[0,0,0]];case"Z":return[[4,4,0],[0,4,4],[0,0,0]]}}getRandomPiece(){if(this.random.length<1)for(;this.random.length<this.pieces.length-1;)this.random.push(this.pieces[this.pieces.length*Math.random()|0]),this.random=this.random.filter((t,e,i)=>i.indexOf(t)===e);const t=this.random[this.random.length*Math.random()|0];return this.random.splice(this.random.indexOf(t),1),this.createPiece(t)}};const n=new class{constructor(t){this.arena=new s(12,20),this.canvas=t.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.lastTime=0,this.piece=new a,this.player=new r(this),this.requestAnimationID=void 0,this.scale=20,this.scoreElement=t.querySelector(".score"),this.context.scale(this.scale,this.scale),this.player.reset(),this.updateScore(this.player.score),this.start()}draw(){this.context.fillStyle="#444",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawMatrix(this.arena.matrix,{x:0,y:0}),this.drawMatrix(this.player.matrix,this.player.position)}drawMatrix(t,e){t.forEach((t,i)=>{t.forEach((t,s)=>{0!==t&&(this.context.fillStyle=this.piece.colors[t],this.context.fillRect(s+e.x,i+e.y,1,1))})})}pause(){if(this.requestAnimationID)return cancelAnimationFrame(this.requestAnimationID),void(this.requestAnimationID=void 0);this.start()}start(){void 0===this.requestAnimationID&&(this.requestAnimationID=requestAnimationFrame(this.update.bind(this)))}update(t=0){const e=t-this.lastTime;this.lastTime=t,this.player.update(e),this.draw(),this.requestAnimationID=requestAnimationFrame(this.update.bind(this))}updateScore(){this.scoreElement.innerText=this.player.score}}(document.querySelector(".game"));document.addEventListener("keydown",t=>{switch(t.keyCode){case 39:n.player.move(1);break;case 37:n.player.move(-1);break;case 40:n.player.drop();break;case 80:n.pause();break;case 87:n.player.rotate(1);break;case 88:n.player.rotate(-1)}})}]);